# 静的ウェブサイトホスティング - 全体像

このドキュメントでは、S3を使用した静的ウェブサイトホスティングに関連する重要な概念を全体的に解説します。

## MIME タイプとファイル形式の理解

**MIME タイプ**とは、ファイルの種類をブラウザに伝える標準化された形式識別子です。S3にアップロードされたファイルがブラウザで正しく表示・処理されるためには、適切なMIME タイプが設定されている必要があります。

例えば：
- HTML ファイル: `text/html`
- CSS ファイル: `text/css`
- JavaScriptファイル: `application/javascript`
- 画像ファイル（JPEG）: `image/jpeg`
- 画像ファイル（PNG）: `image/png`

S3にファイルをアップロードする際、正しいMIME タイプが自動検出されない場合は手動で設定することが重要です。ブラウザは受け取ったMIME タイプに基づいて、ファイルをダウンロードするか表示するかを判断します。

---

## パススタイル URLとバーチャルホストスタイル URL

S3でホストされたコンテンツにアクセスする方法には、2つの異なるURLスタイルがあります。これはS3の設計柔軟性を示す重要な概念です。

### パススタイル URL（Path-style URL）

**形式**：`https://s3.region.amazonaws.com/bucket-name/key`

**特徴**：
- URLのパス部分にバケット名が含まれる
- すべてのリージョンでサポートされている
- 従来の形式で、より広い互換性がある

### バーチャルホストスタイル URL（Virtual-hosted-style URL）

**形式**：`https://bucket-name.s3.region.amazonaws.com/key`

**特徴**：
- バケット名がホスト名（サブドメイン）として機能する
- よりWebスタンダードに沿った形式
- カスタムドメイン設定時に有利
- 一部の古いリージョンでは制限がある場合もある

**選択の重要性**：
- カスタムドメインを使用する場合は、バーチャルホストスタイルが推奨される
- DNSエイリアスやCloudFrontディストリビューションとの連携を考慮する必要がある

---

## SSL/TLS 証明書とHTTPSセキュア接続

### ACM（AWS Certificate Manager）の役割

HTTPSを使用してセキュアな通信を実現するためには、SSL/TLS 証明書が不可欠です。**ACM（AWS Certificate Manager）**は、AWS上で無料にSSL/TLS 証明書の取得・管理・自動更新を行うサービスです。

### セキュアな接続実現の流れ

1. **ACMで証明書を申請**：カスタムドメイン（例：example.com）の証明書を申請
2. **ドメイン所有権の検証**：DNSレコード検証またはメール検証でドメイン所有権を証明
3. **CloudFrontディストリビューションへの適用**：S3の前段に置いたCloudFrontに証明書をバインド
4. **HTTPS通信の確立**：ユーザーとCloudFront間、CloudFrontとS3間で暗号化された通信が成立

### 重要なポイント

- S3単体ではHTTPSをサポートしないため、CloudFrontなどのCDNサービスを併用する必要がある
- ブラウザのアドレスバーに南京錠マークが表示され、ユーザーに安全な接続を示すことができる
- 複数ドメイン対応や難字ドメイン対応の証明書も取得可能

---

## キャッシング戦略

### エッジロケーションでのキャッシュの概念

**CloudFrontのキャッシング**は、静的ウェブサイトのパフォーマンス最適化に不可欠な機能です。CloudFrontは世界中の**エッジロケーション**（キャッシュサーバー）を用いて、コンテンツをユーザーの近くに複製・保存します。

### キャッシング戦略の効果

- **レイテンシー削減**：ユーザーが地理的に近い場所からコンテンツを取得できるため、応答時間が大幅に短縮される
- **オリジンサーバー負荷軽減**：頻繁にアクセスされるコンテンツはエッジロケーションから提供され、S3へのリクエストが減少
- **ネットワーク帯域幅削減**：世界中に分散したエッジロケーションを活用することで、グローバルなネットワーク効率が向上

### 対象となるコンテンツ

- HTML、CSS、JavaScriptなどの静的ファイル
- 画像ファイル
- その他の頻繁に変更されないコンテンツ

### キャッシュTTL（Time To Live）設定

キャッシュ有効期間を適切に設定することで、バランスの取れた運用が実現できます：
- 頻繁に更新されるファイル：短いTTL（例：1時間）
- ほぼ変更されないファイル：長いTTL（例：1年）

---

## Route 53 との連携

### DNS の基本的な役割

**Route 53**はAWSのDNSサービスです。DNSは人間が読みやすいドメイン名（例：example.com）をIPアドレスに変換するシステムです。ウェブサイトをカスタムドメインで公開する際、Route 53はこの名前解決を管理します。

### CloudFront ディストリビューションへの指向

1. **DNS レコード設定**：Route 53でAレコードまたはAliasレコードを作成
2. **CloudFrontディストリビューション指向**：DNSレコードをCloudFrontディストリビューションのドメイン名に指向
3. **ユーザーアクセス流**：
   - ユーザーがexample.comをブラウザに入力
   - Route 53がCloudFrontディストリビューションのIPアドレスを返却
   - ユーザーのリクエストがCloudFrontにルーティングされ、最適なエッジロケーションから配信される

### Aliasレコードの優位性

Route 53固有の機能である**Aliasレコード**により、CloudFrontなどのAWSリソースに直接指向でき、追加の料金なしでDNS クエリを実行できます。

---

## リダイレクト用バケット

### www と非www URL の統一

ウェブサイトは複数のURLパターン（例：www.example.com と example.com）でアクセスされる可能性があります。ユーザー体験とSEOの観点から、これらを統一することが重要です。

### 実装アーキテクチャ

**2つのバケット戦略**：
1. **メインバケット**（例：example.com）：実際のウェブサイトコンテンツをホスト
2. **リダイレクトバケット**（例：www.example.com）：すべてのリクエストをメインバケットへ自動リダイレクト

### リダイレクト設定の流れ

1. メインバケットでウェブサイトホスティングを設定
2. リダイレクトバケットで**ウェブサイトホスティング - リダイレクト**設定を有効化
3. リダイレクト先をメインバケットに指定
4. Route 53で両方のドメイン（www付き・非www）をそれぞれのバケットに指向

### ユーザーフロー

```
ユーザー: www.example.com にアクセス
    ↓
Route 53: www.example.com → リダイレクトバケット
    ↓
リダイレクトバケット: HTTP 301 リダイレクト → example.com
    ↓
ユーザー: example.com にリダイレクト
    ↓
Route 53: example.com → メインバケット（またはCloudFront）
    ↓
メインバケット: ウェブサイトコンテンツを提供
```

---

## DNS、HTTPS、CDN などのウェブ技術の統合

### 全体アーキテクチャの理解

静的ウェブサイトホスティングの発展バージョンでは、複数のウェブ技術が統合されて、**スケーラブルで安全で高速なシステム**が構築されます。

#### 各技術の役割

| 技術 | 役割 | 効果 |
|------|------|------|
| **S3** | コンテンツストレージ | 耐久性99.999999999%、スケーラブルなストレージ |
| **CloudFront** | コンテンツデリバリーネットワーク | グローバルなエッジロケーション活用による高速化 |
| **Route 53** | DNS（名前解決） | ドメイン名からのルーティング、ヘルスチェック |
| **ACM** | SSL/TLS証明書管理 | HTTPS通信、セキュリティ確保 |

### エンドツーエンドのデータフロー

```
ユーザー
  ↓ (ブラウザでexample.com入力)
Route 53
  ↓ (DNSで example.com → CloudFront ドメイン)
CloudFront エッジロケーション
  ↓ (HTTPS、キャッシュから配信)
S3 オリジンサーバー
  ↓ (必要に応じてオリジンからフェッチ)
ユーザー (ウェブサイト表示)
```

### ベストプラクティス

1. **セキュリティファースト**：すべてのアクセスをHTTPSで保護
2. **パフォーマンス重視**：キャッシング戦略とCDNを活用
3. **ドメイン戦略**：www統一を行いユーザー体験を最適化
4. **監視と管理**：Route 53のヘルスチェック、CloudFrontのキャッシュ無効化

---

## まとめ

静的ウェブサイトホスティングは、単なるファイル公開ではなく、MIME タイプ、URL スタイル、セキュリティ、パフォーマンス、DNS、キャッシング戦略といった複数のウェブ技術が緊密に連携したシステムです。これらの各要素を理解することで、スケーラブルで安全で高速なウェブサイトを構築・運営することができます。
