Ansibleの基本的な文法について詳しく説明します。

## Ansibleの基本構造

Ansibleは主に**YAML形式**でPlaybookを記述します。設定管理や自動化タスクを宣言的に定義できるツールです。

## Playbookの基本構造

```yaml
---
- name: Playbookの説明
  hosts: ターゲットホスト
  become: yes  # root権限での実行
  vars:
    変数名: 値
  tasks:
    - name: タスクの説明
      モジュール名:
        パラメータ: 値
```

## 主要な要素

### 1. **hosts（ターゲット指定）**
実行対象のホストやグループを指定します。

```yaml
hosts: webservers
hosts: all
hosts: db01,db02
```

### 2. **tasks（タスク）**
実行する処理を順番に記述します。

```yaml
tasks:
  - name: Apacheのインストール
    apt:
      name: apache2
      state: present
```

### 3. **変数（vars）**
再利用可能な値を定義します。

```yaml
vars:
  http_port: 80
  max_clients: 200

tasks:
  - name: ポート設定
    debug:
      msg: "ポート番号は {{ http_port }} です"
```

### 4. **条件分岐（when）**
条件に応じてタスクを実行します。

```yaml
- name: RedHat系の場合のみ実行
  yum:
    name: httpd
    state: present
  when: ansible_os_family == "RedHat"
```

### 5. **ループ（loop）**
複数の項目に対して同じ処理を実行します。

```yaml
- name: 複数パッケージのインストール
  apt:
    name: "{{ item }}"
    state: present
  loop:
    - vim
    - git
    - curl
```

### 6. **handlers（ハンドラー）**
特定のイベント発生時にのみ実行されるタスクです。

```yaml
tasks:
  - name: 設定ファイルのコピー
    copy:
      src: nginx.conf
      dest: /etc/nginx/nginx.conf
    notify: restart nginx

handlers:
  - name: restart nginx
    service:
      name: nginx
      state: restarted
```

## よく使うモジュール

### システム管理
- **apt/yum**: パッケージ管理
- **service**: サービス制御
- **user**: ユーザー管理
- **file**: ファイル/ディレクトリ操作

### ファイル操作
- **copy**: ファイルコピー
- **template**: テンプレートファイルの展開
- **lineinfile**: ファイルの特定行を編集

### コマンド実行
- **command**: シンプルなコマンド実行
- **shell**: シェル経由でコマンド実行
- **script**: スクリプトファイルの実行

## Inventoryファイル

ターゲットホストを定義するファイルです。

```ini
[webservers]
web01 ansible_host=192.168.1.10
web02 ansible_host=192.168.1.11

[databases]
db01 ansible_host=192.168.1.20

[all:vars]
ansible_user=admin
ansible_ssh_private_key_file=~/.ssh/id_rsa
```

## 実践的な例

```yaml
---
- name: Webサーバーのセットアップ
  hosts: webservers
  become: yes
  
  vars:
    document_root: /var/www/html
  
  tasks:
    - name: Nginxのインストール
      apt:
        name: nginx
        state: present
        update_cache: yes
    
    - name: ドキュメントルートの作成
      file:
        path: "{{ document_root }}"
        state: directory
        owner: www-data
        group: www-data
        mode: '0755'
    
    - name: index.htmlの配置
      copy:
        content: "<h1>Welcome</h1>"
        dest: "{{ document_root }}/index.html"
      notify: reload nginx
  
  handlers:
    - name: reload nginx
      service:
        name: nginx
        state: reloaded
```

## 実行コマンド

```bash
# Playbookの実行
ansible-playbook playbook.yml

# インベントリファイルを指定
ansible-playbook -i inventory.ini playbook.yml

# 構文チェック
ansible-playbook playbook.yml --syntax-check

# ドライラン（実際には実行しない）
ansible-playbook playbook.yml --check
```

Ansibleはシンプルで読みやすい構文が特徴です。何か具体的に知りたい機能や使い方はありますか？