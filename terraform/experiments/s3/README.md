# S3 Static Website Hosting

## 概要
S3を使った静的ウェブサイトホスティングのTerraform構成です。開発環境と本番環境で異なるセキュリティ設定を適用し、環境に応じた最適な構成を実現します。

### 技術スタック
- AWS S3（静的ウェブサイトホスティング）
- Terraform（IaC）
- AWS Provider v6.0

### 作成物
シンプルな静的ウェブサイトをS3上にホスティングします。ユーザーがウェブサイトのURLにアクセスすると、S3バケットに配置されたHTMLファイルが表示されます。エラー時には専用のエラーページが表示され、開発環境ではパブリックアクセスが可能、本番環境ではセキュリティを強化した構成となります。

## 構成ファイル
- **`provider.tf`**: AWSプロバイダーの設定
- **`variables.tf`**: リージョンと環境変数の定義
- **`locals.tf`**: バケット名の生成ロジックとMIMEタイプのマッピング
- **`s3_bucket.tf`**: S3バケット本体とバージョニング設定
- **`s3_policy.tf`**: パブリックアクセス設定とバケットポリシー
- **`s3_website.tf`**: 静的ウェブサイトホスティング設定
- **`s3_objects.tf`**: HTMLファイルのアップロード設定
- **`outputs.tf`**: ウェブサイトのURLとバケット名の出力
- **`dev.tfvars` / `prod.tfvars`**: 環境別の設定値

## コードの特徴
- **環境別セキュリティ制御**: 開発環境ではパブリックアクセスを許可し、本番環境では完全にブロックする条件分岐を実装
- **バケット名の一意性確保**: `data.aws_caller_identity`を使用してアカウントIDとリージョンを組み合わせ、グローバルで一意なバケット名を自動生成
- **自動MIMEタイプ判定**: `locals`ブロックでファイル拡張子とMIMEタイプのマッピングを定義し、`lookup`関数で適切なContent-Typeを自動設定
- **ファイル変更検知**: `etag`属性にMD5ハッシュを使用し、ファイル内容の変更を検知して自動再アップロード
- **バリデーション機能**: 変数定義で許可されたリージョンと環境名のみを受け入れるバリデーションルールを実装

## 注意事項
- バケット名はAWS全体でグローバルに一意である必要があります
- S3ウェブサイトエンドポイントはHTTPのみに対応しており、HTTPSには対応していません
- 本番環境でHTTPSを使用する場合は、CloudFrontとの組み合わせが推奨されます（現在は未実装）
- ファイルは`website/`ディレクトリに`index.html`と`error.html`を配置する必要があります
