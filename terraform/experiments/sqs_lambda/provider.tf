# =============================================================================
# Terraform Provider 設定ファイル
# =============================================================================
# このファイルでは、Terraform の基本設定と AWS プロバイダーの設定を行います。
# provider.tf は Terraform プロジェクトの根幹となる設定ファイルです。
# =============================================================================

# -----------------------------------------------------------------------------
# Terraform ブロック
# -----------------------------------------------------------------------------
# terraform ブロックでは、Terraform 自体の設定を行います。
# - required_version: 使用する Terraform CLI のバージョン制約
# - required_providers: 使用するプロバイダーとそのバージョン制約
#
# 【ベストプラクティス】
# - バージョン制約を明示的に指定することで、チーム間での一貫性を確保
# - 本番環境では、より厳密なバージョン指定（例: ~> 1.6.0）を推奨
# - バージョンアップ時は、変更ログを確認してから更新する
# -----------------------------------------------------------------------------
terraform {
  # ---------------------------------------------------------------------------
  # Terraform バージョン制約
  # ---------------------------------------------------------------------------
  # >= 1.0: バージョン 1.0 以上を要求
  # 
  # 【バージョン制約の書き方】
  # - = 1.0.0  : 完全一致（厳密すぎるため非推奨）
  # - >= 1.0   : 1.0 以上の任意のバージョン
  # - ~> 1.0   : 1.x 系の最新（1.0 以上 2.0 未満）← 推奨
  # - >= 1.0, < 2.0 : 範囲指定
  # ---------------------------------------------------------------------------
  required_version = ">= 1.0"

  # ---------------------------------------------------------------------------
  # 必要なプロバイダーの定義
  # ---------------------------------------------------------------------------
  # プロバイダーは Terraform が各クラウドサービスと通信するためのプラグインです。
  # 
  # 【構成要素】
  # - source: プロバイダーのソース（通常は registry.terraform.io から取得）
  # - version: プロバイダーのバージョン制約
  #
  # 【AWS プロバイダーのバージョンについて】
  # - バージョン 5.x は 2023年にリリースされた最新メジャーバージョン
  # - 4.x から 5.x への移行では破壊的変更があるため注意
  # - 新規プロジェクトでは 5.x 系の使用を推奨
  # ---------------------------------------------------------------------------
  required_providers {
    aws = {
      # Terraform Registry からの取得元を指定
      # hashicorp/aws は公式 AWS プロバイダー
      source = "hashicorp/aws"

      # バージョン 5.0 以上を使用
      # ~> 5.0 とすると 5.x 系の最新を使用（6.0 未満）
      version = ">= 5.0"
    }
  }

  # ---------------------------------------------------------------------------
  # バックエンド設定（オプション）
  # ---------------------------------------------------------------------------
  # 学習用のためローカルバックエンド（デフォルト）を使用
  # 
  # 【本番環境でのベストプラクティス】
  # チーム開発や本番環境では、リモートバックエンド（S3 など）を使用して
  # 状態ファイルを共有・保護することを強く推奨します。
  #
  # 例: S3 バックエンド
  # backend "s3" {
  #   bucket         = "my-terraform-state-bucket"
  #   key            = "sqs-lambda/terraform.tfstate"
  #   region         = "ap-northeast-1"
  #   encrypt        = true
  #   dynamodb_table = "terraform-state-lock"  # 状態ロック用
  # }
  # ---------------------------------------------------------------------------
}

# -----------------------------------------------------------------------------
# AWS プロバイダー設定
# -----------------------------------------------------------------------------
# provider ブロックでは、AWS への接続設定を行います。
#
# 【認証方法の優先順位】（上から順に検索される）
# 1. プロバイダーブロック内の直接指定（非推奨：セキュリティリスク）
# 2. 環境変数（AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY）
# 3. 共有認証情報ファイル（~/.aws/credentials）
# 4. IAM ロール（EC2 インスタンスプロファイル、ECS タスクロールなど）
# 5. AWS SSO / AWS IAM Identity Center
#
# 【ベストプラクティス】
# - 認証情報をコードに直接書かない（セキュリティリスク）
# - 環境変数または AWS CLI の設定ファイルを使用
# - 本番環境では IAM ロールを使用
# - 開発環境では AWS CLI でプロファイルを設定（aws configure）
# -----------------------------------------------------------------------------
provider "aws" {
  # ---------------------------------------------------------------------------
  # リージョン設定
  # ---------------------------------------------------------------------------
  # AWS リージョンを変数から取得
  # 変数化することで、環境ごとに異なるリージョンを使用可能
  #
  # 【主要な AWS リージョン】
  # - ap-northeast-1: 東京（日本からのアクセスに最適）
  # - ap-northeast-3: 大阪
  # - us-east-1: バージニア北部（最も多くのサービスが利用可能）
  # - us-west-2: オレゴン
  # - eu-west-1: アイルランド
  # ---------------------------------------------------------------------------
  region = var.aws_region

  # ---------------------------------------------------------------------------
  # デフォルトタグ（オプション）
  # ---------------------------------------------------------------------------
  # すべてのリソースに自動的に適用されるタグを設定
  # コスト管理、リソース識別、ガバナンスに有用
  #
  # 【タグのベストプラクティス】
  # - Project: プロジェクト名（コスト配分に使用）
  # - Environment: 環境（dev/staging/prod）
  # - ManagedBy: 管理方法（Terraform など）
  # - Owner: 責任者やチーム名
  # ---------------------------------------------------------------------------
  default_tags {
    tags = {
      Project     = "sqs-lambda-study"
      Environment = "development"
      ManagedBy   = "Terraform"
    }
  }

  # ---------------------------------------------------------------------------
  # その他の設定オプション（参考）
  # ---------------------------------------------------------------------------
  # 
  # 【プロファイル指定】
  # AWS CLI で設定した名前付きプロファイルを使用する場合
  # profile = "my-profile"
  #
  # 【認証情報ファイルのパス】
  # デフォルト以外の認証情報ファイルを使用する場合
  # shared_credentials_files = ["~/.aws/credentials"]
  #
  # 【AssumeRole】
  # 別のアカウントやロールを使用する場合
  # assume_role {
  #   role_arn     = "arn:aws:iam::123456789012:role/MyRole"
  #   session_name = "TerraformSession"
  # }
  #
  # 【リトライ設定】
  # API 呼び出しのリトライ回数（デフォルト: 25）
  # max_retries = 10
  # ---------------------------------------------------------------------------
}

# =============================================================================
# 補足情報
# =============================================================================
#
# 【このファイルの役割】
# 1. Terraform のバージョン要件を定義
# 2. 必要なプロバイダーとそのバージョンを宣言
# 3. AWS への接続方法を設定
#
# 【初回セットアップ手順】
# 1. AWS CLI をインストール: brew install awscli
# 2. 認証情報を設定: aws configure
# 3. Terraform を初期化: terraform init
#
# 【トラブルシューティング】
# - "No valid credential sources found": AWS 認証情報が設定されていない
# - "Provider version not found": terraform init -upgrade を実行
# - "Backend initialization required": terraform init を実行
#
# =============================================================================
